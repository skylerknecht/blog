<!DOCTYPE html>
<html>

<head>
    <title>Kerberos within Active Directory</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js" integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>

</head>

<body>
    <div class="container-fluid bg-dark min-vh-100">
        <div class="row font-monospace text-white">
            <div class="col-md-12 text-center p-3 text-white">
                <p class="fs-2">Kerberos within Active Directory</p>
                <p class="fs-6">
                  <a href="{{url_for('home')}}" class="btn btn-secondary btn-sm" style="text-decoration:none;">Home</a>
                  <a href="{{url_for('about')}}" class="btn btn-secondary btn-sm" style="text-decoration:none;">About</a>
                  <a href="{{url_for('blogs')}}" class="btn btn-secondary btn-sm" style="text-decoration:none;">Blogs</a>
                </p>
                <p class="fs-6">- Skyler Knecht, November 8th 2021</p>
                <br><br>
                <p class="fs-4">Service Principal Names</p>
                <p class="fs-7">
                  Within Active Directory, there are a variety of services a security principal (SP) may need to access.
                  To access these services with Kerberos, administrators may configure the service with a Service Principal Name (SPN).
                  If a service is configured with a SPN, then any SP may use Kerberos to authenticate to the service.
                  A SPN is a unique identifier consisting of the service name (i.e., MSSQL), the hostname of system running
                  the service (i.e., WS01.rayke.dev) and an optional port (i.e., 1337). In this instance the SPN would be MSSQL/WS01.rayke.dev:1337.
                  This unique identfier provides an SP with the name of the service, where the service is running and what port the service is running on.
                </p>
                <br><br>
                <p class="fs-4">Ticket Granting Tickets</p>
                <p class="fs-7">
                  To authenticate to a service configured with a SPN, a SP must first obtain a Ticket Granting Ticket (TGT).
                  To obtain a TGT, a SP must communicate to the Authentication Server (AS) by making an Authentication Server Request (AS-REQ).
                  A AS-REQ consists of, The SP's account name and an optional encryption key created from a time-stamp and the SP's NTLM hash.
                  The AS will begin processing the request by checking if the account name is valid. If the account name is invalid then the AS will respond with
                  PRINCIPAL_UNKOWN. If the account name is valid then one of three actions may occur.
                </p>
                <br><br>
                <ol class="fs-7">
                 <li> No encryption key is provided -> AS will respond with KRB5KDC_ERR_PREAUTHREQUIRED. </li>
                 <li> Encryption key is provided -> AS will forward the request to the Key Distribution Center (KDC). </li>
                 <li> Pre-authenticaiton not required -> AS will forward the request to the Key Distribution Center (KDC). </li>
                </ol>
                <br><br>
                <p class="fs-7">
                  The KDC will begin processing the request by first decrypting the encryption key and verifying its authenticity through comparing the current time-stamp.  If the encryption key is not authentic then ...
                  If the encryption key is authentic or if it was not provided as pre-authenticaiton was not required Then the KDC will then respond to the AS with a Ticket Granting Ticket (TGT) a cipher encrypted
                  with the special key of the Ticket Granting Server (TGS). The AS will then respond to the SP through a Authenticaiton Server Response (AS-REP). A AS-REP consists of an encrypted TGT and
                  a cipher of the SP's NTLM Hash. The SP can then decrypt the TGT using their NTLM hash and the cipher provided in the AS-REP.
                </p>
            </div>
        </div>
</body>
</html>
